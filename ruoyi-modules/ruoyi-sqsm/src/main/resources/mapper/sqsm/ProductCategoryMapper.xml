<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.sqsm.mapper.ProductCategoryMapper">

	<resultMap type="ProductCategory" id="ProductCategoryResult">
		<id     property="id"         column="id"          />
		<result property="parentsId"  column="parents_id"  />
		<result property="name"       column="name"        />
		<result property="code"       column="code"        />
		<result property="sort"       column="sort"        />
		<result property="status"     column="status"      />
		<result property="remark"     column="remark"      />
		<result property="cost"       column="cost"        />
		<result property="ancestors"  column="ancestors"   />
		<result property="createBy"   column="create_by"   />
		<result property="createTime" column="create_time" />
		<result property="updateBy"   column="update_by"   />
		<result property="updateTime" column="update_time" />
	</resultMap>

	<sql id="selectCateGoryVo">
		select category.id, category.parents_id, category.name, category.code, category.sort, category.status,
			   category.remark, category.cost, category.ancestors, category.create_by, category.create_time
		from t_rehone_product_category category
	</sql>


	<update id="updateProductCategoryChildren" parameterType="java.util.List">
		update t_rehone_product_category set ancestors =
		<foreach collection="categories" item="item" index="index"
				 separator=" " open="case id" close="end">
			when #{item.id} then #{item.ancestors}
		</foreach>
		where dept_id in
		<foreach collection="depts" item="item" index="index"
				 separator="," open="(" close=")">
			#{item.deptId}
		</foreach>
	</update>

	<select id="selectChildrenProductCategoryById" parameterType="Long" resultMap="ProductCategoryResult">
		select * from t_rehone_product_category where find_in_set(#{id}, ancestors)
	</select>

	<update id="updateProductCategoryStatusNormal" parameterType="Long">
		update t_rehone_product_category set status = '0' where id in
		<foreach collection="array" item="id" open="(" separator="," close=")">
			#{id}
		</foreach>
	</update>

	<select id="hasChildByProductCategoryId" parameterType="Long" resultType="int">
		select count(1) from t_rehone_product_category
		where status = '0' and parents_id = #{id}
	</select>

</mapper> 